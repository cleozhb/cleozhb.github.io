---
title: 链接
date: 2018-12-29 12:29:37
tags: 编译
---

能否正确解析与命令行给出的顺序有关，好的做法是将.o文件按照调用顺序写，将.a文件放在命令行的最后。在命令行中-lxxx=libxxx.a。.a文件又叫做归档（archive）文件，是一些.o文件的集合。
连接器对外部引用的解析过程是：

* 按照命令行给出的顺序扫描.o和.a文件
* 扫描期间将当前未解析的引用记录到一个列表U中
* 每次遇到一个新的.o或者.a中的模块，都试图用其来解析U中的符号
* 如果扫描到最后U中还有未解析的符号，则发生错误

<!--more-->

如果没有按照调用顺序写命令行，会导致连接器将可能用到的.o文件抛弃，这样就无法找到定义，导致undefined reference to '  '错误。如果有循环调用，要将其中一个写两遍，请看第三张PPT最下面一个例子。

![图片](1.png)![图片](2.png)![图片](3.png)![图片](4.png)
链接整个分为两大部分：一个是符号解析（将符号的引用和符号的定义建立关联），一个是重定位（将代码和代码合并、数据和数据合并，其实是做一个向虚拟地址空间的映射）。符号解析之后得到一个集合E，E中放的是所有将要合并的.o文件集合。所有定义符号的集合都在D里面，所以第二步重定位合并节的时候要用到E，将E集合中所有的.o文件进行合并。第二步确定地址，确定D里面所有定义符号的地址;第三步修改所有引用处的地址。

### 参考
.o文件剖析[https://blog.csdn.net/gt1025814447/article/details/80442673](https://blog.csdn.net/gt1025814447/article/details/80442673)
