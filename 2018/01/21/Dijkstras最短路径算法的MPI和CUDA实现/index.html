<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-cn">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="高性能计算,CUDA,MPI," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Dijkstras最短路径算法的MPI和CUDA实现 主要内容   dijkstra串行算法 算法并行性分析 MPI的dijkstra实现 CUDA的dijkstra实现 并行效率分析">
<meta name="keywords" content="高性能计算,CUDA,MPI">
<meta property="og:type" content="article">
<meta property="og:title" content="Dijkstras最短路径算法的MPI和CUDA实现">
<meta property="og:url" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/index.html">
<meta property="og:site_name" content="学思考的小孩儿">
<meta property="og:description" content="Dijkstras最短路径算法的MPI和CUDA实现 主要内容   dijkstra串行算法 算法并行性分析 MPI的dijkstra实现 CUDA的dijkstra实现 并行效率分析">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/1.PNG">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/2.PNG">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/3.PNG">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/4.PNG">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/5.PNG">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/6.PNG">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/7.PNG">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/input1.png">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/MPI拷贝位置.png">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/input1运行过程.png">
<meta property="og:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/input1运行结果.png">
<meta property="og:updated_time" content="2018-01-21T14:07:37.686Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dijkstras最短路径算法的MPI和CUDA实现">
<meta name="twitter:description" content="Dijkstras最短路径算法的MPI和CUDA实现 主要内容   dijkstra串行算法 算法并行性分析 MPI的dijkstra实现 CUDA的dijkstra实现 并行效率分析">
<meta name="twitter:image" content="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/1.PNG">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/"/>





  <title>Dijkstras最短路径算法的MPI和CUDA实现 | 学思考的小孩儿</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-cn">

  















  
  
    
  

  
  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">学思考的小孩儿</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Kategorien
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://silence-inner-peace.github.io/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/image/fly.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学思考的小孩儿">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Dijkstras最短路径算法的MPI和CUDA实现</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-21T21:17:01+08:00">
                2018-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/代码/" itemprop="url" rel="index">
                    <span itemprop="name">代码</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h2 id="Dijkstras最短路径算法的MPI和CUDA实现"><a href="#Dijkstras最短路径算法的MPI和CUDA实现" class="headerlink" title="Dijkstras最短路径算法的MPI和CUDA实现"></a>Dijkstras最短路径算法的MPI和CUDA实现</h2><blockquote>
<p>主要内容</p>
</blockquote>
<ul>
<li>dijkstra串行算法</li>
<li>算法并行性分析</li>
<li>MPI的dijkstra实现</li>
<li>CUDA的dijkstra实现</li>
<li>并行效率分析</li>
</ul>
<a id="more"></a>
<h3 id="dijkstra串行算法"><a href="#dijkstra串行算法" class="headerlink" title="dijkstra串行算法"></a>dijkstra串行算法</h3><p><em>串行算法核心思想</em></p>
<p>引入一个辅助向量D，它的每个分量D[i]为源顶点v到其他顶点v[i]的路径长度。初始态为：如有从v到vi的路径，则D[i]为弧[v,vi]的权值；否则D[i]为无穷大。显然D[j] = min{D[i]}为顶点v出发到其他顶点的一条最短路径的长度，其路径为（v，vj）。下一条最短路径长度要么是源顶点v直接到某一顶点vk的长度，即{v，vk}。要么是源顶点v经过顶点vj到某一顶点的长度，即{v，vj，vk}。假设S为已经求得最短路径的顶点的集合，下一条最短路径（设其终点为x），要么是弧{v， vx}，要么为中间只经过S中顶点而最后到达终点X的路径。<br>在一般情况下，下一条最短路径的长度为：D[j] = min{D[i] | vi 属于 V-S} 其中V为图顶点的集合， D[i]为弧{v， vi}的权值，或者为D[k]和弧{vk， vi}权值之和。</p>
<p><em>串行算法描述</em><br>输入：图G的邻接矩阵m[0…n-1][0…n-1]，源顶点 v<br>输出：最短路径值向量D[0…n-1], 最短路径矩阵p[0…n-1][0…n-2].其中D[i]为源顶点v到顶点vi的最短路径长度，向量p[i]为源顶点v到顶点vi的最短路径<br>1）初始化D[i]<br>     D[i] = m[v][vi] == 无穷大 ? 无穷大 : m[v][vi]<br>2)计算当前最短路径值<br>     min = min{D[i]}<br>     final[i] = 1   //标记顶点i已经取得最短路径<br>3）更新最短路径值及最短路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">for(i = 0; i &lt; n; i++)</div><div class="line">    if(!final[i])</div><div class="line">        if(D[i] &gt; min + m[vk][vi])</div><div class="line">            D[i] = min + m[vk][vi];</div><div class="line">        end if</div><div class="line">     endif</div><div class="line">    for( j = 0; j &lt; n-1 ; j++)</div><div class="line">          if(p[vk][j] != 无穷大)</div><div class="line">              p[vi][j] = p[vk][j];</div><div class="line">         end if</div><div class="line">    end for</div><div class="line">    p[vi][j] = vi</div><div class="line">end for</div></pre></td></tr></table></figure></p>
<p>4) 输出最短路径和最短路径值</p>
<h3 id="算法并行性分析"><a href="#算法并行性分析" class="headerlink" title="算法并行性分析"></a>算法并行性分析</h3><p>对这个算法进行并行化分析，显然初始化向量D，更新最短路径值是可以并行化实现的，因为只要有了当前最短路径和最短路径值，各个顶点的最短路径的算法是相互独立的。也就是说虽然第一层循环是有依赖关系不可以并行化，但是内层循环是相互独立的。所以在并行化算法中，如何求得当前的最短路径和最短路径值成为关键。</p>
<p>假设一共用P个进程，让每个进程负责n/p个顶点，每个进程都有自己的向量D和最短路径p。首先，可以计算出各个进程的当前最短路径，并将局部最短路径发往进程0，进程0对这些进程的最短路径进行规约，取得当前的全局最短路径，并将这一结果广播到所有的进程。</p>
<p>对于CUDA程序来说，我设想每个block就对应MPI中的一个进程。</p>
<ol>
<li>设置共享内存thread_local_min来存放每个线程计算出来的最小值，每个block中一个线程处理几个顶点，用<code>int element_per_thread = (int)ceil(N*1.0 / (blockDim.x*gridDim.x));</code> 来计算每个线程要处理的顶点的个数。每个线程获取自己对应的节点到源点的距离，存到thread_local_min中。然后进行一个同步操作syncthreads();每个block中blockIdx.x=0的线程负责从thread_local_min中计算整个block中的局部最小，存到d_local_min。</li>
<li>再由这些局部最小计算一个global_min。</li>
<li>最后在每个线程中重新计算每个顶点与全局最小的new_dist，<code>new_dist = d_all_dist[u] + mat[u*N + global_index]</code>,并进行更新。</li>
</ol>
<h3 id="MPI的dijkstra实现"><a href="#MPI的dijkstra实现" class="headerlink" title="MPI的dijkstra实现"></a>MPI的dijkstra实现</h3><p>变量定义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">int loc_N; // I need a local copy for N</div><div class="line">int loc_n; //how many vertices I need to process.</div><div class="line">int *loc_mat; //local matrix</div><div class="line">int *loc_dist; //local distance</div><div class="line">int *loc_pred; //local predecessor</div><div class="line">bool *loc_visit; //local visit record array</div><div class="line">int *displs; // Integer array (of length group size) containing the number of elements </div><div class="line">// that are received from each process (significant only at root).</div><div class="line">// 整型数组(长度为组的大小), 其值为从每个进程接收的数据个数(仅对于根进程)</div><div class="line"></div><div class="line"></div><div class="line">int *rcounts; //Integer array (of length group size). Entry i specifies the displacement </div><div class="line">// relative to recvbuf at which to place the incoming data from process i</div><div class="line">// 整数数组,每个入口i表示相对于recvbuf的位移,此位移处存放着从进程i中接收的输入数据(仅对于根进程)</div></pre></td></tr></table></figure></p>
<p><strong>step 1: broadcast N</strong>：广播N<br><strong>step 2: find loc_n</strong>：总节点个数除以进程数,得到平均每个处理器要处理的节点个数<br><strong>step 3: allocate local memory</strong>：分配局部内存<br><strong>step 4: broadcast matrix mat</strong>：广播邻接矩阵权重<br><strong>step 5: dijkstra algorithm</strong>:循环N次，每次找出一个全局最小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div></pre></td><td class="code"><pre><div class="line">#include &quot;stdafx.h&quot;</div><div class="line">#include &lt;stdio.h&gt; </div><div class="line">#include &lt;mpi.h&gt;</div><div class="line">#include &lt;time.h&gt;</div><div class="line">#include&lt;iostream&gt;</div><div class="line">using namespace std;</div><div class="line">#include &lt;string&gt;</div><div class="line">#include &lt;cassert&gt;</div><div class="line">#include &lt;fstream&gt;</div><div class="line">#include &lt;vector&gt;</div><div class="line">#include &lt;climits&gt;</div><div class="line">#include &lt;cstring&gt;</div><div class="line">#include &lt;algorithm&gt;</div><div class="line">//#include &quot;mpi.h&quot;</div><div class="line"></div><div class="line">using std::string;</div><div class="line">using std::cout;</div><div class="line">using std::endl;</div><div class="line">using std::vector;</div><div class="line"></div><div class="line">//#define DE_BUG</div><div class="line"></div><div class="line">/*</div><div class="line">* utils is a namespace for utility functions</div><div class="line">* including I/O (read input file and print results) and one matrix dimension convert(2D-&gt;1D) function</div><div class="line">*/</div><div class="line">namespace utils &#123;</div><div class="line">    int N; //number of vertices</div><div class="line">    int *mat; // the adjacency matrix</div><div class="line"></div><div class="line">    /*</div><div class="line">    * convert 2-dimension coordinate to 1-dimension</div><div class="line">    */</div><div class="line">    int convert_dimension_2D_1D(int x, int y) &#123;</div><div class="line">        return x * N + y;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    int read_file(string filename) &#123;</div><div class="line">        std::ifstream inputf(filename, std::ifstream::in);</div><div class="line">        inputf &gt;&gt; N;</div><div class="line">        assert(N &lt; (1024 * 1024 *</div><div class="line">            20)); // input matrix should be smaller than 20MB * 20MB (400MB, we don&apos;t have two much memory for multi-processors)</div><div class="line">        mat = (int *)malloc(N * N * sizeof(int));</div><div class="line">        for (int i = 0; i &lt; N; i++)</div><div class="line">        for (int j = 0; j &lt; N; j++) &#123;</div><div class="line">            inputf &gt;&gt; mat[convert_dimension_2D_1D(i, j)];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    string format_path(int i, int *pred) &#123;</div><div class="line">        string out(&quot;&quot;);</div><div class="line">        int current_vertex = i;</div><div class="line">        while (current_vertex != 0) &#123;</div><div class="line">            string s = std::to_string(current_vertex);</div><div class="line">            std::reverse(s.begin(), s.end());</div><div class="line">            out = out + s + &quot;&gt;-&quot;;</div><div class="line">            current_vertex = pred[current_vertex];</div><div class="line">        &#125;</div><div class="line">        out = out + std::to_string(0);</div><div class="line">        std::reverse(out.begin(), out.end());</div><div class="line">        return out;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    int print_result(int *dist, int *pred) &#123;</div><div class="line">        std::ofstream outputf(&quot;output.txt&quot;, std::ofstream::out);</div><div class="line">        outputf &lt;&lt; dist[0];</div><div class="line">        for (int i = 1; i &lt; N; i++) &#123;</div><div class="line">            outputf &lt;&lt; &quot; &quot; &lt;&lt; dist[i];</div><div class="line">        &#125;</div><div class="line">        for (int i = 0; i &lt; N; i++) &#123;</div><div class="line">            outputf &lt;&lt; &quot;\n&quot;;</div><div class="line">            if (dist[i] &gt;= 1000000) &#123;</div><div class="line">                outputf &lt;&lt; &quot;NO PATH&quot;;</div><div class="line">            &#125;</div><div class="line">            else &#123;</div><div class="line">                outputf &lt;&lt; format_path(i, pred);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        outputf &lt;&lt; endl;</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line">&#125;//namespace utils</div><div class="line">// you may add some helper functions here.</div><div class="line"></div><div class="line">//找每个子图中距离最小的一个</div><div class="line">int find_local_minimum(int *dist, bool *visit, int loc_n) &#123;</div><div class="line">    int min = INT_MAX;</div><div class="line">    int u = -1;</div><div class="line">    for (int i = 0; i &lt; loc_n; i++) &#123;</div><div class="line">        if (!visit[i]) &#123;</div><div class="line">            if (dist[i] &lt; min) &#123;</div><div class="line">                min = dist[i];</div><div class="line">                u = i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return u;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">void dijkstra(int my_rank, int N, int p, MPI_Comm comm, int *mat, int *all_dist, int *all_pred)</div><div class="line">&#123;</div><div class="line"></div><div class="line">    //------your code starts from here------</div><div class="line">    int loc_N; // I need a local copy for N</div><div class="line">    int loc_n; //how many vertices I need to process.</div><div class="line">    int *loc_mat; //local matrix</div><div class="line">    int *loc_dist; //local distance</div><div class="line">    int *loc_pred; //local predecessor</div><div class="line">    bool *loc_visit; //local visit record array</div><div class="line"></div><div class="line">    int *displs; // Integer array (of length group size) containing the number of elements </div><div class="line">    // that are received from each process (significant only at root).</div><div class="line">    // 整型数组(长度为组的大小), 其值为从每个进程接收的数据个数(仅对于根进程)</div><div class="line"></div><div class="line"></div><div class="line">    int *rcounts; //Integer array (of length group size). Entry i specifies the displacement </div><div class="line">    // relative to recvbuf at which to place the incoming data from process i</div><div class="line">    // 整数数组,每个入口i表示相对于recvbuf的位移,此位移处存放着从进程i中接收的输入数据(仅对于根进程)</div><div class="line">    // step 1: broadcast N</div><div class="line">    if (my_rank == 0) &#123;</div><div class="line">        loc_N = N;</div><div class="line">    &#125;</div><div class="line">    //MPI_Bcast(address,count,datatype,root,comm)</div><div class="line">    MPI_Bcast(&amp;loc_N, 1, MPI_INT, 0, comm);</div><div class="line"></div><div class="line">    //step 2: find loc_n,总节点个数除以进程数,得到平均每个处理器要处理的节点个数</div><div class="line">    loc_n = loc_N / p;</div><div class="line">    //最后一个进程可能分配的节点个数要少一些</div><div class="line">    if (my_rank == p - 1) &#123;</div><div class="line">        loc_n = loc_N - (p - 1) * loc_n;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //#ifdef DE_BUG</div><div class="line">    //  std::cout &lt;&lt; &quot;MPI process: &quot; &lt;&lt; my_rank &lt;&lt; &quot;  loc_n: &quot; &lt;&lt; loc_n &lt;&lt; std::endl;</div><div class="line">    //#endif</div><div class="line"></div><div class="line">    //step 3: allocate local memory,分配局部内存</div><div class="line">    loc_mat = (int *)malloc(sizeof(int)* loc_N *loc_N);</div><div class="line">    loc_dist = (int *)malloc(sizeof(int)* loc_n);</div><div class="line">    loc_pred = (int *)malloc(sizeof(int)* loc_n);</div><div class="line">    loc_visit = (bool *)malloc(loc_n * sizeof(bool));</div><div class="line"></div><div class="line">    displs = (int *)calloc(p, sizeof(int));</div><div class="line">    rcounts = (int *)calloc(p, sizeof (int));</div><div class="line"></div><div class="line">    int index = 0;</div><div class="line">    for (int i = 0; i &lt; p; ++i) &#123;</div><div class="line">        if (i != p - 1) &#123;</div><div class="line">            rcounts[i] = loc_N / p;</div><div class="line">            displs[i] = index;</div><div class="line">        &#125;</div><div class="line">        else &#123;</div><div class="line">            rcounts[i] = loc_N - loc_N / p * i;</div><div class="line">            displs[i] = index;</div><div class="line">        &#125;</div><div class="line">        index += rcounts[i];</div><div class="line">    &#125;</div><div class="line">    std::cout &lt;&lt; &quot;MPI process: &quot; &lt;&lt; my_rank &lt;&lt; &quot; rcounts[0]&quot; &lt;&lt; rcounts[0] &lt;&lt;&quot; displs[0]&quot; &lt;&lt;rcounts[1] &lt;&lt; std::endl;</div><div class="line">    //step 4: broadcast matrix mat</div><div class="line">    if (my_rank == 0) &#123;</div><div class="line">        memcpy(loc_mat, mat, loc_N * loc_N * sizeof (int));</div><div class="line">    &#125;</div><div class="line">    MPI_Bcast(loc_mat, loc_N * loc_N, MPI_INT, 0, comm);</div><div class="line"></div><div class="line">    //step 4: dijkstra algorithm</div><div class="line">    // initial loc_dist, loc_pred, loc_vist</div><div class="line">    //找出与source节点相连的所有节点，将其访问状态置为false</div><div class="line">    //loc_dist中保存的是当前处理器需要处理的所有节点的与source的距离</div><div class="line">    //loc_pred中保存了当前处理节点的上一个节点</div><div class="line">    //loc_visit中保存了当前节点是否确定了最短距离</div><div class="line">    for (int loc_i = 0; loc_i &lt; loc_n; loc_i++) &#123;</div><div class="line">        int u = my_rank * (loc_N / p) + loc_i;</div><div class="line">        loc_dist[loc_i] = loc_mat[utils::convert_dimension_2D_1D(0, u)];</div><div class="line">        loc_pred[loc_i] = 0;</div><div class="line">        loc_visit[loc_i] = false;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //将source节点的访问状态置为true</div><div class="line">    if (my_rank == 0) &#123;</div><div class="line">        loc_visit[0] = true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    for (int i = 1; i &lt; loc_N; i++) &#123;</div><div class="line">        // find the global minimum</div><div class="line">        int loc_u = find_local_minimum(loc_dist, loc_visit, loc_n);//找局部最小值</div><div class="line">        int loc_min[2], glo_min[2];</div><div class="line">        if (loc_u == -1)&#123;</div><div class="line">            loc_min[0] = INT_MAX;</div><div class="line">            loc_min[1] = my_rank * (loc_N / p) + loc_u;</div><div class="line">        &#125;</div><div class="line">        else&#123;</div><div class="line">            loc_min[0] = loc_dist[loc_u];</div><div class="line">            loc_min[1] = my_rank * (loc_N / p) + loc_u;</div><div class="line">        &#125;</div><div class="line">        if (i == 1)&#123;</div><div class="line">            std::cout &lt;&lt; &quot;MPI process: &quot; &lt;&lt; my_rank &lt;&lt; &quot; [0]&quot; &lt;&lt; loc_min[0] &lt;&lt;&quot;[1]&quot; &lt;&lt; loc_min[1] &lt;&lt; std::endl;</div><div class="line">        &#125;</div><div class="line">        // 找全局最小值</div><div class="line">        MPI_Allreduce(loc_min, glo_min, 1, MPI_2INT, MPI_MINLOC, comm);</div><div class="line">        //找出全局最小值所在的线程，将其访问状态置为true</div><div class="line">        int visit_pro = glo_min[1] / (loc_N / p);</div><div class="line">        if (visit_pro == p)&#123;</div><div class="line">            visit_pro = p - 1;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (my_rank == visit_pro) &#123;</div><div class="line">            int u = glo_min[1] - visit_pro * (loc_N / p);</div><div class="line">            loc_visit[u] = true;</div><div class="line">        &#125;</div><div class="line">        //遍历其他节点，更新距离值</div><div class="line">        for (int v = 0; v &lt; loc_n; v++) &#123;</div><div class="line"></div><div class="line">            if (!loc_visit[v]) &#123;</div><div class="line">                int new_dist = glo_min[0] + loc_mat[utils::convert_dimension_2D_1D(glo_min[1], my_rank * (loc_N / p) + v)];</div><div class="line">                if (new_dist &lt; loc_dist[v]) &#123;</div><div class="line">                    loc_dist[v] = new_dist;</div><div class="line">                    loc_pred[v] = glo_min[1];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //step 5: retrieve results back</div><div class="line">    //Hint: use MPI_Gather(or MPI_Gatherv) function</div><div class="line"></div><div class="line">/*</div><div class="line">  MPI_GATHERV(sendbuf, sendcount, sendtype, recvbuf, recvcounts, displs, recvtype, root, comm)</div><div class="line">  IN     sendbuf      发送消息缓冲区的起始地址(可变)</div><div class="line">  IN     sendcount    发送消息缓冲区中的数据个数(整型)</div><div class="line">  IN     sendtype     发送消息缓冲区中的数据类型(句柄)</div><div class="line">  OUT    recvbuf      接收消息缓冲区的起始地址(可变,仅对于根进程)</div><div class="line">  IN     recvcounts   整型数组(长度为组的大小), 其值为从每个进程接收的数据个数(仅对于根进程)</div><div class="line">  IN     displs       整数数组,每个入口i表示相对于recvbuf的位移,此位移处存放着从进程i中接收的输入数据(仅对于根进程)</div><div class="line">  IN     recvtype     接收消息缓冲区中数据类型(仅对于根进程)(句柄)</div><div class="line">  IN     root         接收进程的序列号(句柄)</div><div class="line">  IN     comm         通信子(句柄)</div><div class="line">*/</div><div class="line"></div><div class="line">    MPI_Gatherv(loc_dist, loc_n, MPI_INT, all_dist, rcounts, displs, MPI_INT, 0, comm);</div><div class="line">    MPI_Gatherv(loc_pred, loc_n, MPI_INT, all_pred, rcounts, displs, MPI_INT, 0, comm);</div><div class="line"></div><div class="line">    //step 6: remember to free memory</div><div class="line">    free(loc_mat);</div><div class="line">    free(loc_dist);</div><div class="line">    free(loc_pred);</div><div class="line">    free(loc_visit);</div><div class="line"></div><div class="line">    //------end of your code------</div><div class="line">&#125;</div><div class="line"></div><div class="line">int main(int argc, char **argv) &#123;</div><div class="line">    assert(argc &gt; 1 &amp;&amp; &quot;Input file was not found!&quot;);</div><div class="line">    string filename = argv[1];</div><div class="line">    assert(utils::read_file(filename) == 0);</div><div class="line"></div><div class="line">    //`all_dist` stores the distances and `all_pred` stores the predecessors</div><div class="line">    double starttime, endtime;</div><div class="line">    int *all_dist;</div><div class="line">    int *all_pred;</div><div class="line">    all_dist = (int *)calloc(utils::N, sizeof(int));</div><div class="line">    all_pred = (int *)calloc(utils::N, sizeof(int));</div><div class="line">    //MPI initialization</div><div class="line">    MPI_Init(&amp;argc, &amp;argv);</div><div class="line">    starttime = MPI_Wtime(); // 矩阵开始计算的时间 </div><div class="line"></div><div class="line">    MPI_Comm comm;</div><div class="line"></div><div class="line">    int p;//number of processors</div><div class="line">    int my_rank;//my global rank</div><div class="line"></div><div class="line">    comm = MPI_COMM_WORLD;</div><div class="line">    MPI_Comm_size(comm, &amp;p);</div><div class="line">    MPI_Comm_rank(comm, &amp;my_rank);</div><div class="line"></div><div class="line">    dijkstra(my_rank, utils::N, p, comm, utils::mat, all_dist, all_pred);</div><div class="line"></div><div class="line">    if (my_rank == 0)</div><div class="line">        utils::print_result(all_dist, all_pred);</div><div class="line">    endtime = MPI_Wtime(); // 矩阵结束计算的时间 </div><div class="line">    MPI_Finalize();</div><div class="line"></div><div class="line">    free(utils::mat);</div><div class="line">    free(all_dist);</div><div class="line">    free(all_pred);</div><div class="line">    printf(&quot;********MPI_dijkstra算法所用时间为 :=%f\n&quot;, endtime - starttime);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="CUDA的dijkstra实现"><a href="#CUDA的dijkstra实现" class="headerlink" title="CUDA的dijkstra实现"></a>CUDA的dijkstra实现</h3><p>参考教程，只实现三个kernel函数<br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/1.PNG" alt=""><br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/2.PNG" alt=""><br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/3.PNG" alt=""><br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/4.PNG" alt=""><br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/5.PNG" alt=""><br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/6.PNG" alt=""><br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/7.PNG" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div></pre></td><td class="code"><pre><div class="line">#include &lt;string&gt;</div><div class="line">#include &lt;cassert&gt;</div><div class="line">#include &lt;iostream&gt;</div><div class="line">#include &lt;fstream&gt;</div><div class="line">#include &lt;vector&gt;</div><div class="line">#include &lt;climits&gt;</div><div class="line">#include &lt;cstring&gt;</div><div class="line">#include &lt;cmath&gt;</div><div class="line">#include &lt;algorithm&gt;</div><div class="line">#include &lt;time.h&gt;</div><div class="line">#include &lt;time.h&gt;</div><div class="line">#include &quot;getopt.h&quot;</div><div class="line"></div><div class="line">#include &quot;cuda_runtime.h&quot;</div><div class="line">#include &quot;device_launch_parameters.h&quot;</div><div class="line"></div><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;Windows.h&gt;</div><div class="line"></div><div class="line">int gettimeofday(struct timeval * tp, void *tzp)</div><div class="line">&#123;</div><div class="line">    time_t clock;</div><div class="line">    struct tm tm;</div><div class="line">    SYSTEMTIME wtm;</div><div class="line">    GetLocalTime(&amp;wtm);</div><div class="line">    tm.tm_year = wtm.wYear - 1900;</div><div class="line">    tm.tm_mon = wtm.wMonth - 1;</div><div class="line">    tm.tm_mday = wtm.wDay;</div><div class="line">    tm.tm_hour = wtm.wHour;</div><div class="line">    tm.tm_min = wtm.wMinute;</div><div class="line">    tm.tm_sec = wtm.wSecond;</div><div class="line">    tm.tm_isdst = -1;</div><div class="line">    clock = mktime(&amp;tm);</div><div class="line">    tp-&gt;tv_sec = clock;</div><div class="line">    tp-&gt;tv_usec = wtm.wMilliseconds * 1000;</div><div class="line">    return (0);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">using std::string;</div><div class="line">using std::cout;</div><div class="line">using std::endl;</div><div class="line">using std::vector;</div><div class="line">using std::ceil;</div><div class="line">using std::memcpy;</div><div class="line"></div><div class="line">#define INF 1000000</div><div class="line"></div><div class="line">/*</div><div class="line">* This is a CHECK function to check CUDA calls</div><div class="line">*/</div><div class="line">#define CHECK(call)                                                            \</div><div class="line">&#123;                                                                              \</div><div class="line">    const cudaError_t error = call;                                            \</div><div class="line">if (error != cudaSuccess)                                                  \</div><div class="line">&#123;                                                                          \</div><div class="line">    fprintf(stderr, &quot;Error: %s:%d, &quot;, __FILE__, __LINE__);                 \</div><div class="line">    fprintf(stderr, &quot;code: %d, reason: %s\n&quot;, error, \</div><div class="line">    cudaGetErrorString(error));                                    \</div><div class="line">    exit(1);                                                               \</div><div class="line">&#125;                                                                          \</div><div class="line">&#125;</div><div class="line"></div><div class="line">/*</div><div class="line">* utils is a namespace for utility functions</div><div class="line">* including I/O (read input file and print results) and one matrix dimension convert(2D-&gt;1D) function</div><div class="line">*/</div><div class="line">namespace utils &#123;</div><div class="line">    int num_threads; //number of thread</div><div class="line">    int N; //number of vertices</div><div class="line">    int *mat; // the adjacency matrix</div><div class="line"></div><div class="line">    string filename; // input file name</div><div class="line">    string outputfile; //output file name, default: &apos;output.txt&apos;</div><div class="line"></div><div class="line">    void print_usage() &#123;</div><div class="line">        cout &lt;&lt; &quot;Usage:\n&quot; &lt;&lt; &quot;\tcuda_dijkstra -n &lt;number of threads per block&gt; -i &lt;input file&gt;&quot; &lt;&lt; endl;</div><div class="line">        exit(0);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    int parse_args(int argc, char **argv) &#123;</div><div class="line">        filename = &quot;&quot;;</div><div class="line">        outputfile = &quot;output.txt&quot;;</div><div class="line">        num_threads = 0;</div><div class="line"></div><div class="line">        int opt;</div><div class="line">        if (argc &lt; 2) &#123;</div><div class="line">            print_usage();</div><div class="line">        &#125;</div><div class="line">        while ((opt = getopt(argc, argv, &quot;n:i:o:h&quot;)) != EOF) &#123;</div><div class="line">            switch (opt) &#123;</div><div class="line">            case &apos;n&apos;:</div><div class="line">                num_threads = atoi(optarg);</div><div class="line">                break;</div><div class="line">            case &apos;i&apos;:</div><div class="line">                filename = optarg;</div><div class="line">                break;</div><div class="line">            case &apos;o&apos;:</div><div class="line">                outputfile = optarg;</div><div class="line">                break;</div><div class="line">            case &apos;h&apos;:</div><div class="line">            case &apos;?&apos;:</div><div class="line">            default:</div><div class="line">                print_usage();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if (filename.length() == 0 || num_threads == 0)</div><div class="line">            print_usage();</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /*</div><div class="line">    * convert 2-dimension coordinate to 1-dimension</div><div class="line">    */</div><div class="line">    int convert_dimension_2D_1D(int x, int y) &#123;</div><div class="line">        return x * N + y;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    int read_file(string filename) &#123;</div><div class="line">        std::ifstream inputf(filename, std::ifstream::in);</div><div class="line">        inputf &gt;&gt; N;</div><div class="line">        assert(N &lt; (1024 * 1024 *</div><div class="line">            20)); // input matrix should be smaller than 20MB * 20MB (400MB, we don&apos;t have too much memory for multi-processors)</div><div class="line">        mat = (int *)malloc(N * N * sizeof(int));</div><div class="line">        for (int i = 0; i &lt; N; i++)</div><div class="line">        for (int j = 0; j &lt; N; j++) &#123;</div><div class="line">            inputf &gt;&gt; mat[convert_dimension_2D_1D(i, j)];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    string format_path(int i, int *pred) &#123;</div><div class="line">        string out(&quot;&quot;);</div><div class="line">        int current_vertex = i;</div><div class="line">        while (current_vertex != 0) &#123;</div><div class="line">            string s = std::to_string(current_vertex);</div><div class="line">            std::reverse(s.begin(), s.end());</div><div class="line">            out = out + s + &quot;&gt;-&quot;;</div><div class="line">            current_vertex = pred[current_vertex];</div><div class="line">        &#125;</div><div class="line">        out = out + std::to_string(0);</div><div class="line">        std::reverse(out.begin(), out.end());</div><div class="line">        return out;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    int print_result(int *dist, int *pred) &#123;</div><div class="line">        std::ofstream outputf(outputfile, std::ofstream::out);</div><div class="line">        outputf &lt;&lt; dist[0];</div><div class="line">        for (int i = 1; i &lt; N; i++) &#123;</div><div class="line">            outputf &lt;&lt; &quot; &quot; &lt;&lt; dist[i];</div><div class="line">        &#125;</div><div class="line">        for (int i = 0; i &lt; N; i++) &#123;</div><div class="line">            outputf &lt;&lt; &quot;\n&quot;;</div><div class="line">            if (dist[i] &gt;= 1000000) &#123;</div><div class="line">                outputf &lt;&lt; &quot;NO PATH&quot;;</div><div class="line">            &#125;</div><div class="line">            else &#123;</div><div class="line">                outputf &lt;&lt; format_path(i, pred);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        outputf &lt;&lt; endl;</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line">&#125;//namespace utils</div><div class="line"></div><div class="line"></div><div class="line">//------You may add helper functions and global variables here------</div><div class="line"></div><div class="line">/*</div><div class="line">* function: find the local minimum for each block and store them to d_local_min and d_local_min_index</div><div class="line">* parameters: N: input size, *d_visit: array to record which vertex has been visited, *d_all_dist: array to store the distance,</div><div class="line">*        *d_local_min: array to store the local minimum value for each block, *d_local_min_index: array to store the local minimum index for each block</div><div class="line">*/</div><div class="line">__global__ void FindLocalMin(int N, int *d_visit, int *d_all_dist, int *d_local_min, int *d_local_min_index) &#123;</div><div class="line">    //给每个block分配节点，一个线程对应一个节点，求出一个block的局部最小</div><div class="line">    int element_per_thread = (int)ceil(N*1.0 / (blockDim.x*gridDim.x));</div><div class="line">    //存储每个线程的最小值,一个线程对应一个节点</div><div class="line">    __shared__ int thread_local_min[1024];//共享内存存储每个线程找到的最小值</div><div class="line">    __shared__ int thread_local_min_index[1024];</div><div class="line"></div><div class="line">    int threadID = blockIdx.x*blockDim.x + threadIdx.x;</div><div class="line">    </div><div class="line">    int my_start = threadID*element_per_thread;//当前线程块要找的点的范围start——end，若不能整除，最后一个线程块处理的要少一些；</div><div class="line">    int my_end = my_start + element_per_thread;</div><div class="line">    if (my_end &gt; N)</div><div class="line">    &#123;</div><div class="line">        my_end = N;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    thread_local_min[threadIdx.x] = INT_MAX;//设定当前线程最小值</div><div class="line">    thread_local_min_index[threadIdx.x] = -1;</div><div class="line"></div><div class="line">    for (int i = 0; i&lt;element_per_thread; i++)</div><div class="line">    &#123;</div><div class="line">        int gindex = threadID*element_per_thread + i;//计算当前节点在全局中的位置</div><div class="line">        if (gindex&lt;N)</div><div class="line">        &#123;</div><div class="line">            if (!d_visit[gindex])</div><div class="line">            &#123;</div><div class="line">                if (d_all_dist[gindex] &lt; thread_local_min[threadIdx.x])</div><div class="line">                &#123;</div><div class="line">                    thread_local_min[threadIdx.x] = d_all_dist[gindex];</div><div class="line">                    thread_local_min_index[threadIdx.x] = gindex;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    __syncthreads();</div><div class="line"></div><div class="line">    //用该block的第一个局部线程计算局部最小</div><div class="line">    if (threadIdx.x == 0)</div><div class="line">    &#123;</div><div class="line">        d_local_min[blockIdx.x] = INT_MAX;</div><div class="line">        d_local_min_index[blockIdx.x] = -1;</div><div class="line">        for (int i = 0; i &lt; blockDim.x; i++)</div><div class="line">        &#123;</div><div class="line">            if (thread_local_min[i] &lt; d_local_min[blockIdx.x])</div><div class="line">            &#123;</div><div class="line">                d_local_min[blockIdx.x] = thread_local_min[i];</div><div class="line">                d_local_min_index[blockIdx.x] = thread_local_min_index[i];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    __syncthreads();</div><div class="line">&#125;</div><div class="line"></div><div class="line">/*</div><div class="line">* function: update the global minimum value(and index), store them to a global memory address</div><div class="line">* parameters: *global_min: memory address to store the global min value, *global_min_index: memory address to store the global min index</div><div class="line">*        *d_local_min: array stores the local min value od each block, *d_local_min_index: array stores the local min index of each block</div><div class="line">*        *d_visit: array stores the status(visited/un-visited) for each vertex</div><div class="line">*/</div><div class="line">__global__ void</div><div class="line">UpdateGlobalMin(int *global_min, int *global_min_index, int *d_local_min, int *d_local_min_index, int *d_visit) &#123;</div><div class="line">    if (blockIdx.x == 0)&#123;</div><div class="line">        *global_min = INT_MAX;</div><div class="line">        *global_min_index = -1;</div><div class="line">        for (int i = 0; i &lt; gridDim.x; i++)&#123;</div><div class="line">            if (d_local_min[i] &lt; *global_min)&#123;</div><div class="line">                *global_min = d_local_min[i];</div><div class="line">                *global_min_index = d_local_min_index[i];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/*</div><div class="line">* function: update the shortest path for every un-visited vertices</div><div class="line">* parameters: N: input size, *mat: input matrix, *d_visit: array stores the status(visited/un-visited) for each vertex</div><div class="line">*             *d_all_dist: array stores the shortest distance for each vertex, *d_all_pred: array stores the predecessors</div><div class="line">*             *global_min: memory address that stores the global min value, *global_min_index: memory address that stores the global min index</div><div class="line">*/</div><div class="line">__global__ void</div><div class="line">UpdatePath(int N, int *mat, int *d_visit, int *d_all_dist, int *d_all_pred, int *global_min, int *global_min_index) &#123;</div><div class="line">    int element_per_thread = (int)ceil(N*1.0 / (blockDim.x*gridDim.x));</div><div class="line">    </div><div class="line">    int threadID = blockDim.x*blockIdx.x + threadIdx.x;</div><div class="line">    d_visit[*global_min_index] = 1;</div><div class="line">    int u = *global_min_index;</div><div class="line">    for (int i = 0; i &lt; element_per_thread; i++)//每个线程要处理的点</div><div class="line">    &#123;</div><div class="line">        int gindex = threadID*element_per_thread + i;</div><div class="line">        if (gindex &lt; N)</div><div class="line">        &#123;</div><div class="line">            if (!d_visit[gindex])</div><div class="line">            &#123;</div><div class="line">                int new_dist = d_all_dist[u] + mat[u*N + gindex];//计算当前全局最小到所有其他节点的新距离</div><div class="line">                if (new_dist &lt; d_all_dist[gindex])//若新值小于原先源点到该点的距离，更新</div><div class="line">                &#123;</div><div class="line">                    d_all_dist[gindex] = new_dist;</div><div class="line">                    d_all_pred[gindex] = u;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//Do not change anything below this line</div><div class="line">void dijkstra(int N, int p, int *mat, int *all_dist, int *all_pred) &#123;</div><div class="line"></div><div class="line">    //threads number for each block should smaller than or equal to 1024</div><div class="line">    assert(p &lt;= 1024);</div><div class="line"></div><div class="line">    //we restrict this value to 8, DO NOT change it!</div><div class="line">    int blocksPerGrid = 8;</div><div class="line"></div><div class="line">    //NOTICE: (p * 8) may LESS THAN N</div><div class="line">    int threadsPerBlock = p;</div><div class="line"></div><div class="line">    dim3 blocks(blocksPerGrid);</div><div class="line">    dim3 threads(threadsPerBlock);</div><div class="line"></div><div class="line"></div><div class="line">    //allocate memory</div><div class="line">    int *h_visit;</div><div class="line">    int *d_mat, *d_visit, *d_all_dist, *d_all_pred, *d_local_min, *d_local_min_index;</div><div class="line">    int *d_global_min, *d_global_min_index;</div><div class="line"></div><div class="line">    h_visit = (int *)calloc(N, sizeof(int));</div><div class="line">    cudaMalloc(&amp;d_mat, sizeof(int)* N * N);</div><div class="line">    cudaMalloc(&amp;d_visit, sizeof(int)* N);</div><div class="line">    cudaMalloc(&amp;d_all_dist, sizeof(int)* N);</div><div class="line">    cudaMalloc(&amp;d_all_pred, sizeof(int)* N);</div><div class="line">    cudaMalloc(&amp;d_local_min, sizeof(int)* blocksPerGrid);</div><div class="line">    cudaMalloc(&amp;d_local_min_index, sizeof(int)* blocksPerGrid);</div><div class="line">    cudaMalloc(&amp;d_global_min, sizeof(int));</div><div class="line">    cudaMalloc(&amp;d_global_min_index, sizeof(int));</div><div class="line"></div><div class="line">    //initialization and copy data from host to device</div><div class="line">    for (int i = 0; i &lt; N; i++) &#123;</div><div class="line">        all_dist[i] = mat[i];</div><div class="line">        all_pred[i] = 0;</div><div class="line">        h_visit[i] = 0;</div><div class="line">    &#125;</div><div class="line">    h_visit[0] = 1;</div><div class="line"></div><div class="line">    cudaMemcpy(d_mat, mat, sizeof(int)* N * N, cudaMemcpyHostToDevice);</div><div class="line">    cudaMemcpy(d_all_dist, all_dist, sizeof(int)* N, cudaMemcpyHostToDevice);</div><div class="line">    cudaMemcpy(d_all_pred, all_pred, sizeof(int)* N, cudaMemcpyHostToDevice);</div><div class="line">    cudaMemcpy(d_visit, h_visit, sizeof(int)* N, cudaMemcpyHostToDevice);</div><div class="line"></div><div class="line">    //dijkstra iterations</div><div class="line">    for (int iter = 1; iter &lt; N; iter++) &#123;</div><div class="line">        FindLocalMin &lt;&lt; &lt; blocks, threads &gt;&gt; &gt; (N, d_visit, d_all_dist, d_local_min, d_local_min_index);</div><div class="line">        //CHECK(cudaDeviceSynchronize()); //only for debug</div><div class="line">        UpdateGlobalMin &lt;&lt; &lt; blocks, threads &gt;&gt; &gt;</div><div class="line">            (d_global_min, d_global_min_index, d_local_min, d_local_min_index, d_visit);</div><div class="line">        //CHECK(cudaDeviceSynchronize()); //only for debug</div><div class="line">        UpdatePath &lt;&lt; &lt; blocks, threads &gt;&gt; &gt;</div><div class="line">            (N, d_mat, d_visit, d_all_dist, d_all_pred, d_global_min, d_global_min_index);</div><div class="line">        //CHECK(cudaDeviceSynchronize()); //only for debug</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //copy results from device to host</div><div class="line">    cudaMemcpy(all_dist, d_all_dist, sizeof(int)* N, cudaMemcpyDeviceToHost);</div><div class="line">    cudaMemcpy(all_pred, d_all_pred, sizeof(int)* N, cudaMemcpyDeviceToHost);</div><div class="line"></div><div class="line">    //free memory</div><div class="line">    free(h_visit);</div><div class="line">    cudaFree(d_mat);</div><div class="line">    cudaFree(d_visit);</div><div class="line">    cudaFree(d_all_dist);</div><div class="line">    cudaFree(d_all_pred);</div><div class="line">    cudaFree(d_local_min);</div><div class="line">    cudaFree(d_local_min_index);</div><div class="line">    cudaFree(d_global_min);</div><div class="line">    cudaFree(d_global_min_index);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">int main(int argc, char **argv) &#123;</div><div class="line">    assert(utils::parse_args(argc, argv) == 0);</div><div class="line">    assert(utils::read_file(utils::filename) == 0);</div><div class="line"></div><div class="line">    //`all_dist` stores the distances and `all_pred` stores the predecessors</div><div class="line">    int *all_dist;</div><div class="line">    int *all_pred;</div><div class="line">    all_dist = (int *)calloc(utils::N, sizeof(int));</div><div class="line">    all_pred = (int *)calloc(utils::N, sizeof(int));</div><div class="line"></div><div class="line">    //time counter</div><div class="line">    timeval start_wall_time_t, end_wall_time_t;</div><div class="line">    float ms_wall;</div><div class="line"></div><div class="line">    cudaDeviceReset();</div><div class="line"></div><div class="line">    //start timer</div><div class="line">    gettimeofday(&amp;start_wall_time_t, nullptr);</div><div class="line">    dijkstra(utils::N, utils::num_threads, utils::mat, all_dist, all_pred);</div><div class="line">    CHECK(cudaDeviceSynchronize());</div><div class="line"></div><div class="line">    //end timer</div><div class="line">    gettimeofday(&amp;end_wall_time_t, nullptr);</div><div class="line">    ms_wall = ((end_wall_time_t.tv_sec - start_wall_time_t.tv_sec) * 1000 * 1000</div><div class="line">        + end_wall_time_t.tv_usec - start_wall_time_t.tv_usec) / 1000.0;</div><div class="line"></div><div class="line">    std::cerr &lt;&lt; &quot;Time(ms): &quot; &lt;&lt; ms_wall &lt;&lt; endl;</div><div class="line"></div><div class="line">    utils::print_result(all_dist, all_pred);</div><div class="line"></div><div class="line">    free(utils::mat);</div><div class="line">    free(all_dist);</div><div class="line">    free(all_pred);</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>并行效率分析<br>在自己的笔记本上跑不出来什么好的效果，昨天在工作站上用4核CPU跑的MPI，5000个点很快。不知道CUDA会不会更快。数据量还是不够大。</li>
</ul>
<p>下面是在笔记本上的运行结果。并行算法用到的MPI函数主要为点对点通信函数MPI_Send和MPI_Recv，全局通信函数MPI_Bcast，MPI_Allreduce。MPI名字起的真好，消息传递编程，我觉得MPI算法的核心就是任务的划分和任务间的通信。<br>实验数据input1.txt和input2.txt。input1包含16个节点，input2包含5000个节点。input1.txt如下图所示<br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/input1.png" alt=""><br>运行程序生成可执行文件，将其拷贝到对应文件夹下（如下图所示）<br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/MPI拷贝位置.png" alt=""><br>打开shell窗口，将位置导航到cpp文件夹所在的文件夹下，执行以下命令：<br>mpiexec -n <num_prossessor> 程序名称 <inputfile><br>例如：mpiexec -n 4 MPItest1 input2.txt<br>输出结果（下图第一个的为输入input1.txt,第二个的输入为input2.txt）中所用时间为开启的4个线程分别用的时间，可以看到无论输入数据只有16个点还是有5000个点，进程1所用时间几乎是进程2、3、4的两倍，节点几乎是平均分配的，按照程序中的分配原则，只有最后一个进程分配到的节点数量可能比前面的要少一些。0号进程运行时间长应该是因为我计时的程序并不仅仅是dijkstra算法这一部分，还包括了其他比如I/O的时间。而这一部分是由0号进程去做的。下图第一个是在两个测试集上运行的结果，第二个为程序的输出。<br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/input1运行过程.png" alt=""><br><img src="/2018/01/21/Dijkstras最短路径算法的MPI和CUDA实现/input1运行结果.png" alt=""></inputfile></num_prossessor></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/高性能计算/" rel="tag"># 高性能计算</a>
          
            <a href="/tags/CUDA/" rel="tag"># CUDA</a>
          
            <a href="/tags/MPI/" rel="tag"># MPI</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/20/Ubuntu配置MPICH/" rel="next" title="Ubuntu配置MPICH">
                <i class="fa fa-chevron-left"></i> Ubuntu配置MPICH
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/19/什么是科研/" rel="prev" title="什么是科研">
                什么是科研 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Inhaltsverzeichnis
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Übersicht
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/image/fly.jpg"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description">From zero to hero</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">Artikel</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">Kategorien</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">Tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/silence-inner-peace" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/yuan-hong-94-43/activities" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.github.com" title="Github" target="_blank">Github</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.imooc.com" title="imooc" target="_blank">imooc</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.ted.com" title="TED" target="_blank">TED</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.nowcoder.com" title="nowcoder" target="_blank">nowcoder</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.bbc.co.uk/learningenglish/english/features/6-minute-english" title="BBC" target="_blank">BBC</a>
                </li>
              
            </ul>
          </div>
        
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=110167&auto=0&height=66"></iframe>
        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Dijkstras最短路径算法的MPI和CUDA实现"><span class="nav-number">1.</span> <span class="nav-text">Dijkstras最短路径算法的MPI和CUDA实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#dijkstra串行算法"><span class="nav-number">1.1.</span> <span class="nav-text">dijkstra串行算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#算法并行性分析"><span class="nav-number">1.2.</span> <span class="nav-text">算法并行性分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MPI的dijkstra实现"><span class="nav-number">1.3.</span> <span class="nav-text">MPI的dijkstra实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CUDA的dijkstra实现"><span class="nav-number">1.4.</span> <span class="nav-text">CUDA的dijkstra实现</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
